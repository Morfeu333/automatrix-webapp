{$DOMAIN:localhost} {
    # Security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
        Permissions-Policy "camera=(), microphone=(), geolocation=()"
        -Server
    }

    # Next.js Application
    handle /* {
        reverse_proxy webapp:3000
    }

    # Supabase API
    handle /supabase/* {
        uri strip_prefix /supabase
        reverse_proxy supabase-kong:8000
    }

    # N8N Webhooks
    handle /n8n/* {
        uri strip_prefix /n8n
        reverse_proxy n8n:5678
    }
}
